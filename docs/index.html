<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>zhumingcan_web</title>
        <link rel="stylesheet" type="text/css" href="popWindow.css">
    </head>
    <body background="images/gura.JPG"
        style="background-repeat:no-repeat;
                background-size: cover;
                height: 1800px;
                width: 1500px;">
<!--预设脚本如下-->
        浏览量:&nbsp;<span id="" class="leancloud_visitors" data-flag-title=""> - </span>次
        <!-- 同时兼容http与https -->
<script src="//code.bdstatic.com/npm/leancloud-storage@4.13.2/dist/av-min.js"></script>
<script>
    // 第一个参数是appid，第二个参数是appkey，此处的只是示例
    !function () {
    var view = document.querySelector('div.message');
    var model = {
        init:function () {
            var appid = "HiLEQW3JY361nRTpUYIdu8V3-gzGzoHsz";
            var appkey = "xDW9CgvGM3XNWt5eFp7AOBRA";
            AV.init({appId:appid,appKey:appkey});
        },
        // 获取数据
        fetch:function () {
            var query = new AV.Query('Comment');
            return query.find()// 返回 Promise对象
        },
        // 保存数据
        save:function (name,comment) {
            var Comment = AV.Object.extend('Comment');
            var c = new Comment();
            return c.save({
                'name': name,
                'comment': comment
            }) // 返回 Promise对象
        }
    };
    var controller = {
        view:null,
        model:null,
        init: function(view,model) {
            this.view = view;
            this.model = model;
            this.model.init();
            this.loadMessage();
            this.bindEvents();
        },
        bindEvents:function(){
            var form = this.view.querySelector('form');
            form.addEventListener('submit',(e)=>{
                e.preventDefault();
                this.saveMessage();
            })
        },
        saveMessage:function(){
            let name = this.view.querySelector('input[name=name]').value;
            let comment = this.view.querySelector('input[name=comment]').value;
            this.model.save(name,comment)
                .then(function(object) {
                    // 将数据新增到页面上
                    let ul = this.view.querySelector('.messageList');
                    let li = this.view.createElement('li');
                    li.innerText = name+' : '+comment;
                    ul.appendChild(li);
                    // 将两个input输入框的内容清空
                    this.view.querySelector('input[name=name]').value = '';
                    this.view.querySelector('input[name=comment]').value = '';
                })
        },
        loadMessage:function(){
            this.model.fetch()
                .then((e)=>{
                    let array = e.map((item)=>{return item.attributes});
                    let ul = document.querySelector('.messageList');
                    array.forEach((e)=>{
                        let li = document.createElement('li');
                        li.innerText = e.name+' : '+e.comment;
                        ul.appendChild(li);
                    })
                })
        }
    }
    controller.init.call(controller,view,model);
}.call()
</script>

        
        <script>
            var visitor = localStorage.getItem('name');
            if(visitor != "null" && visitor != "" && visitor!=null){
                let message = "你好, " + visitor + "!欢迎你的再次来访";
                alert(message);
            }
            else{
                visitor = window.prompt("Please enter your nickname or name to let me know who is visiting\n请输入你的昵称或姓名让我知道是谁在访问","kobe");
                localStorage.setItem('name',visitor);
                if(visitor != null && visitor != ""){
                    let message = "你好, " + visitor + "! 今天心情如何？";
                    alert(message);
                }
            }
        </script>
<!--正式展示内容如下-->
    <div id="mainContent" style="display: none;">
        <div id="repository" class="mainContent">
            <i style="font-size:xx-large;">个人仓库地址</i><br>
            <a href="https://github.com/zhumingcan666/ios_Calculator.git"><strong style="color:brown;font-size: x-large;">Calculator</strong></a>
            <a href="https://github.com/zhumingcan666/CarrotFantasy.git"><strong style="color: brown;font-size: x-large;">CarrotFantasy</strong></a>
        </div>

        <div id="books" class="mainContent">
            <i style="font-size:xx-large;">个人书架</i><br>
            <strong style="color:brown;font-size: x-large;">SwiftUI与Combine编程</strong>
            <a href="books/swift.epub"><i>在线阅读</i></a> <i style="font-size: x-large;">or</i> <a href="books/swift.epub" download><i>下载</i></a>
        </div>
    </div>

    <div class="message">
    <h1>Comment</h1>
    <hr>
    <ul class="messageList"></ul>
    <form action="">
        <label for="">name</label>
        <input type="text" name="name">
        <label for="">comment</label>
        <input type="text" name="comment">
        <input type="submit" value="submit">
    </form>
    </div>

<!--以下为非正式页面内容-->

        <div id="overLay">
            <div class="popUp">
                <i class="popUpTitle">WELCOME!</i><br>
                <i class="popUpContent">随便看看吧</i>
                <div class="popUpButtomBlock">
                    <button class="popUpButton" onclick="checked()">已阅</button>
                    <button class="popUpButton" onclick="checked()">滚滚滚</button>
                </div>
            </div>

            <script>
                function checked(){
                    var overLay = document.getElementById("overLay");
                    var others = document.getElementById("mainContent");
                    overLay.style.display = "none";
                    others.style.display = "block";
                }
                function showPopWindow(){
                    var overLay = document.getElementById("overLay");
                    overLay.style.display = "block";
                }
                window.onload = showPopWindow;
            </script>
        </div>


    </body>
</html>
